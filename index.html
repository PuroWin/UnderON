<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚡ UnderON - Sistema Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --text-light: #94a3b8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: var(--dark); color: var(--text); line-height: 1.6; }
        .app-header { background: var(--primary); padding: 20px; text-align: center; }
        .logo { font-size: 1.8rem; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .tabs { display: flex; background: var(--card); border-radius: 12px; margin: 20px; padding: 5px; }
        .tab { flex: 1; padding: 12px; text-align: center; border-radius: 8px; cursor: pointer; }
        .tab.active { background: var(--primary); color: white; }
        .tab-content { display: none; padding: 0 20px; }
        .tab-content.active { display: block; }
        .card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #334155; }
        .card-title { font-size: 1.3rem; margin-bottom: 15px; color: var(--text); display: flex; align-items: center; gap: 10px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--text-light); }
        input, select { width: 100%; padding: 12px; background: #334155; border: 1px solid #475569; color: white; border-radius: 8px; }
        .btn { width: 100%; padding: 15px; background: var(--success); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .stat-card { background: rgba(99, 102, 241, 0.1); padding: 15px; border-radius: 12px; text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: bold; margin: 10px 0; }
        .game-card { background: var(--card); padding: 15px; margin: 10px 0; border-radius: 12px; border-left: 4px solid var(--primary); }
        .odds-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .odd-item { background: #334155; padding: 10px; border-radius: 8px; text-align: center; }
        .odd-value { font-size: 1.1rem; font-weight: bold; color: var(--success); }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: var(--primary); animation: spin 1s infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--success); color: white; padding: 15px 25px; border-radius: 12px; display: none; }
        .toast.show { display: flex; align-items: center; gap: 10px; animation: slideUp 0.3s; }
        @keyframes slideUp { from { bottom: -100px; opacity: 0; } to { bottom: 100px; opacity: 1; } }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); padding: 15px; display: flex; justify-content: space-around; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-light); font-size: 0.8rem; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-chart-line"></i>
            <span>UnderON PRO</span>
        </div>
    </header>

    <div class="tabs">
        <div class="tab active" data-tab="dashboard">Dashboard</div>
        <div class="tab" data-tab="matches">Jogos</div>
        <div class="tab" data-tab="backtest">Backtest</div>
        <div class="tab" data-tab="settings">Config</div>
    </div>

    <div class="tab-content active" id="dashboard-tab">
        <div class="card">
            <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> Estatísticas</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div>Total</div>
                    <div class="stat-value" id="statTotal">0</div>
                </div>
                <div class="stat-card">
                    <div>% Acerto</div>
                    <div class="stat-value" id="statAccuracy">0%</div>
                </div>
                <div class="stat-card">
                    <div>Lucro</div>
                    <div class="stat-value" id="statProfit">R$0</div>
                </div>
                <div class="stat-card">
                    <div>ROI</div>
                    <div class="stat-value" id="statROI">0%</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-search"></i> Buscar Jogos</h2>
            <div class="input-group">
                <label>Liga</label>
                <select id="leagueSelect">
                    <option value="PL">Premier League</option>
                    <option value="PD">La Liga</option>
                    <option value="SA">Série A</option>
                    <option value="BL1">Bundesliga</option>
                    <option value="BSA">Brasileirão</option>
                </select>
            </div>
            <button class="btn" onclick="searchMatches()"><i class="fas fa-search"></i> Buscar</button>
        </div>
    </div>

    <div class="tab-content" id="matches-tab">
        <div class="card">
            <h2 class="card-title"><i class="fas fa-futbol"></i> Próximos Jogos</h2>
            <div id="matchesList">Selecione uma liga e busque jogos</div>
        </div>
    </div>

    <div class="tab-content" id="backtest-tab">
        <div class="card">
            <h2 class="card-title"><i class="fas fa-flask"></i> Backtest</h2>
            <div class="input-group">
                <label>Jogo</label>
                <input type="text" id="btGame" placeholder="Ex: Liverpool x City">
            </div>
            <div class="input-group">
                <label>Projeção</label>
                <input type="number" step="0.1" id="btProjection" placeholder="2.5">
            </div>
            <div class="input-group">
                <label>Gols Reais</label>
                <input type="number" id="btReal" placeholder="2">
            </div>
            <button class="btn" onclick="addBacktest()"><i class="fas fa-save"></i> Salvar</button>
        </div>
        <div class="card">
            <h2 class="card-title"><i class="fas fa-history"></i> Histórico</h2>
            <div id="backtestHistory"></div>
        </div>
    </div>

    <div class="tab-content" id="settings-tab">
        <div class="card">
            <h2 class="card-title"><i class="fas fa-key"></i> API Key</h2>
            <div class="input-group">
                <label>Football-Data.org Key</label>
                <input type="password" id="apiKey" placeholder="Cole sua chave">
            </div>
            <button class="btn" onclick="saveSettings()"><i class="fas fa-save"></i> Salvar</button>
        </div>
    </div>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" data-tab="dashboard">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-tab="matches">
            <i class="fas fa-futbol"></i>
            <span>Jogos</span>
        </div>
        <div class="nav-item" data-tab="backtest">
            <i class="fas fa-chart-bar"></i>
            <span>Backtest</span>
        </div>
        <div class="nav-item" data-tab="settings">
            <i class="fas fa-cog"></i>
            <span>Config</span>
        </div>
    </nav>

<script>
// CONFIGURAÇÃO
const CONFIG = {
    apiKey: localStorage.getItem('underon_key') || '',
    games: JSON.parse(localStorage.getItem('underon_games')) || [],
    stake: 100
};

// INICIALIZAÇÃO
document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
    loadDashboard();
    if (CONFIG.apiKey) document.getElementById('apiKey').value = CONFIG.apiKey;
});

// EVENT LISTENERS
function setupEventListeners() {
    // Tabs
    document.querySelectorAll('.tab, .nav-item').forEach(el => {
        el.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            switchTab(tabId);
        });
    });
}

// FUNÇÕES DE UI
function switchTab(tabId) {
    // Esconder todas
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab, .nav-item').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Mostrar selecionada
    document.getElementById(tabId + '-tab').classList.add('active');
    document.querySelectorAll(`[data-tab="${tabId}"]`).forEach(tab => {
        tab.classList.add('active');
    });
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const icon = toast.querySelector('i');
    const msg = document.getElementById('toastMessage');
    
    if (type === 'success') {
        toast.style.background = 'var(--success)';
        icon.className = 'fas fa-check-circle';
    } else if (type === 'error') {
        toast.style.background = 'var(--danger)';
        icon.className = 'fas fa-exclamation-circle';
    }
    
    msg.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// DASHBOARD
function loadDashboard() {
    const total = CONFIG.games.length;
    const wins = CONFIG.games.filter(g => g.won).length;
    const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
    const profit = CONFIG.games.reduce((sum, g) => sum + g.profit, 0);
    const roi = total > 0 ? (profit / (total * CONFIG.stake) * 100).toFixed(1) : 0;
    
    document.getElementById('statTotal').textContent = total;
    document.getElementById('statAccuracy').textContent = winRate + '%';
    document.getElementById('statProfit').textContent = 'R$' + profit.toFixed(2);
    document.getElementById('statROI').textContent = roi + '%';
}

// BUSCAR JOGOS
async function searchMatches() {
    if (!CONFIG.apiKey) {
        showToast('Configure API key primeiro!', 'error');
        switchTab('settings');
        return;
    }
    
    const league = document.getElementById('leagueSelect').value;
    const matchesDiv = document.getElementById('matchesList');
    
    matchesDiv.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
    
    try {
        const response = await fetch(`https://api.football-data.org/v4/competitions/${league}/matches`, {
            headers: { 'X-Auth-Token': CONFIG.apiKey }
        });
        
        if (!response.ok) throw new Error('API Error');
        
        const data = await response.json();
        displayMatches(data.matches || []);
        
    } catch (error) {
        showToast('Erro API. Dados simulados.', 'error');
        displayMockMatches();
    }
}

function displayMatches(matches) {
    const matchesDiv = document.getElementById('matchesList');
    
    if (matches.length === 0) {
        matchesDiv.innerHTML = '<p>Nenhum jogo encontrado</p>';
        return;
    }
    
    let html = '';
    matches.slice(0, 10).forEach(match => {
        const date = new Date(match.utcDate);
        const avgGoals = (Math.random() * 3 + 1.5).toFixed(1);
        
        html += `
            <div class="game-card" onclick="selectMatch('${match.homeTeam.name}', '${match.awayTeam.name}', ${avgGoals})">
                <div style="display: flex; justify-content: space-between;">
                    <strong>${match.homeTeam.name} vs ${match.awayTeam.name}</strong>
                    <span style="color: var(--text-light); font-size: 0.9rem;">${date.toLocaleDateString('pt-BR')}</span>
                </div>
                <div class="odds-container">
                    <div class="odd-item">
                        <div>Under 2.5</div>
                        <div class="odd-value">${(1.5 + Math.random() * 0.7).toFixed(2)}</div>
                    </div>
                    <div class="odd-item">
                        <div>Under 3.5</div>
                        <div class="odd-value">${(1.3 + Math.random() * 0.5).toFixed(2)}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; color: var(--text-light);">
                    <i class="fas fa-chart-line"></i> Projeção: ${avgGoals} gols
                </div>
            </div>
        `;
    });
    
    matchesDiv.innerHTML = html;
}

function displayMockMatches() {
    const mockMatches = [
        { homeTeam: { name: 'Liverpool' }, awayTeam: { name: 'Manchester City' }, utcDate: new Date().toISOString() },
        { homeTeam: { name: 'Real Madrid' }, awayTeam: { name: 'Barcelona' }, utcDate: new Date().toISOString() },
        { homeTeam: { name: 'Bayern Munich' }, awayTeam: { name: 'Borussia Dortmund' }, utcDate: new Date().toISOString() },
        { homeTeam: { name: 'Flamengo' }, awayTeam: { name: 'Palmeiras' }, utcDate: new Date().toISOString() }
    ];
    
    displayMatches(mockMatches);
}

function selectMatch(home, away, projection) {
    document.getElementById('btGame').value = `${home} vs ${away}`;
    document.getElementById('btProjection').value = projection;
    switchTab('backtest');
    showToast('Jogo selecionado!', 'success');
}

// BACKTEST
function addBacktest() {
    const game = document.getElementById('btGame').value;
    const projection = parseFloat(document.getElementById('btProjection').value);
    const real = parseInt(document.getElementById('btReal').value);
    
    if (!game || !projection || !real) {
        showToast('Preencha todos os campos!', 'error');
        return;
    }
    
    // Calcular margem
    let margin = projection <= 2.0 ? 1.5 : projection <= 2.5 ? 1.0 : 0.5;
    const betLimit = projection + margin;
    const won = real < betLimit;
    const profit = won ? 80 : -100; // Assume odd 1.80
    
    const gameData = {
        id: Date.now(),
        name: game,
        projection: projection,
        real: real,
        bet: `Under ${betLimit.toFixed(1)}`,
        won: won,
        profit: profit,
        date: new Date().toLocaleDateString('pt-BR')
    };
    
    CONFIG.games.push(gameData);
    localStorage.setItem('underon_games', JSON.stringify(CONFIG.games));
    
    loadDashboard();
    loadBacktestHistory();
    
    showToast(`${won ? '✅ GANHOU' : '❌ PERDEU'} R$${profit.toFixed(2)}`, won ? 'success' : 'error');
    
    // Limpar
    document.getElementById('btGame').value = '';
    document.getElementById('btProjection').value = '';
    document.getElementById('btReal').value = '';
}

function loadBacktestHistory() {
    const historyDiv = document.getElementById('backtestHistory');
    
    if (CONFIG.games.length === 0) {
        historyDiv.innerHTML = '<p>Nenhum jogo ainda</p>';
        return;
    }
    
    let html = '';
    CONFIG.games.slice().reverse().forEach(game => {
        html += `
            <div class="game-card" style="border-left-color: ${game.won ? 'var(--success)' : 'var(--danger)'}">
                <div style="display: flex; justify-content: space-between;">
                    <strong>${game.name}</strong>
                    <span style="color: ${game.won ? 'var(--success)' : 'var(--danger)'}">
                        ${game.won ? '✅' : '❌'}
                    </span>
                </div>
                <p>Proj: ${game.projection} | Real: ${game.real}</p>
                <p>Aposta: ${game.bet}</p>
                <p style="color: ${game.profit >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                    R$ ${game.profit.toFixed(2)}
                </p>
                <small style="color: var(--text-light);">${game.date}</small>
            </div>
        `;
    });
    
    historyDiv.innerHTML = html;
}

// CONFIGURAÇÕES
function saveSettings() {
    const key = document.getElementById('apiKey').value.trim();
    if (key) {
        CONFIG.apiKey = key;
        localStorage.setItem('underon_key', key);
        showToast('API key salva!', 'success');
    }
}

// INICIALIZAR HISTÓRICO
loadBacktestHistory();
</script>
</body>
</html>
